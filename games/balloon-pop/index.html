<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#667eea" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Balloon Pop - Play It My Way</title>
    <meta name="description" content="Free balloon popping game for kids ages 5+. Pop balloons with numbers and letters in order. Fun and educational game for children." />
    <style>
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
      }

      body {
        font-family: "Comic Sans MS", "Arial Rounded MT Bold", "Arial", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 10px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-x: hidden;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 10px;
        z-index: 10;
      }

      .header h1 {
        font-size: clamp(1.5em, 5vw, 2em);
        font-weight: bold;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        margin: 0;
      }

      .stats {
        display: flex;
        gap: 20px;
        margin-bottom: 10px;
        color: white;
        font-size: clamp(1em, 3vw, 1.2em);
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        z-index: 10;
      }

      .mode-selector {
        margin-bottom: 10px;
        z-index: 10;
      }

      .mode-btn {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: clamp(0.85em, 2.5vw, 1em);
        font-weight: bold;
        cursor: pointer;
        margin: 3px;
        transition: transform 0.2s;
      }

      .mode-btn.active {
        background: linear-gradient(45deg, #4ecdc4, #44a08d);
        transform: scale(1.05);
      }

      .target-display {
        background: rgba(255, 255, 255, 0.9);
        padding: 10px 25px;
        border-radius: 15px;
        margin-bottom: 10px;
        font-size: clamp(1.2em, 4vw, 1.5em);
        font-weight: bold;
        color: #333;
        z-index: 10;
      }

      .game-area {
        position: relative;
        width: 100%;
        max-width: 500px;
        height: 450px;
        background: linear-gradient(180deg, #87CEEB 0%, #E0F7FA 100%);
        border-radius: 15px;
        overflow: hidden;
        border: 4px solid #333;
      }

      .balloon {
        position: absolute;
        width: 60px;
        height: 75px;
        cursor: pointer;
        transition: transform 0.1s;
        animation: float 3s ease-in-out infinite;
      }

      .balloon:hover {
        transform: scale(1.1);
      }

      .balloon-body {
        width: 60px;
        height: 70px;
        border-radius: 50% 50% 50% 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5em;
        font-weight: bold;
        color: white;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        position: relative;
        box-shadow: inset -5px -5px 15px rgba(0, 0, 0, 0.2), 
                    inset 5px 5px 15px rgba(255, 255, 255, 0.3);
      }

      .balloon-body::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: 12px solid inherit;
      }

      .balloon-string {
        position: absolute;
        bottom: -20px;
        left: 50%;
        width: 2px;
        height: 20px;
        background: #666;
        transform: translateX(-50%);
      }

      @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
      }

      .pop-effect {
        position: absolute;
        font-size: 40px;
        animation: pop 0.4s ease-out forwards;
        pointer-events: none;
        z-index: 100;
      }

      @keyframes pop {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(2); opacity: 0; }
      }

      .score-popup {
        position: absolute;
        font-size: 20px;
        font-weight: bold;
        color: #4ecdc4;
        animation: scoreUp 0.8s ease-out forwards;
        pointer-events: none;
        z-index: 100;
      }

      @keyframes scoreUp {
        0% { transform: translateY(0); opacity: 1; }
        100% { transform: translateY(-40px); opacity: 0; }
      }

      .controls {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        z-index: 10;
      }

      .btn {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        font-size: clamp(1em, 3vw, 1.1em);
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .btn:hover { transform: scale(1.05); }

      .back-link {
        position: absolute;
        top: 15px;
        left: 15px;
        color: white;
        text-decoration: none;
        font-size: clamp(0.9em, 3vw, 1em);
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 12px;
        border-radius: 20px;
        z-index: 100;
      }

      /* Modal */
      .modal-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-overlay.show { display: flex; }

      .modal {
        background: white;
        border-radius: 20px;
        padding: 30px;
        text-align: center;
        max-width: 350px;
        width: 90%;
        animation: scaleIn 0.3s ease;
      }

      .modal h2 { font-size: 1.8em; margin-bottom: 10px; color: #333; }
      .modal p { font-size: 1.2em; color: #666; margin: 10px 0; }

      .stars { font-size: 2.5em; margin: 10px 0; }
      .star { color: #ddd; }
      .star.filled { color: #ffd700; }

      .high-score { color: #ff6b6b; font-weight: bold; }

      .modal-btn {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 25px;
        font-size: 1.1em;
        font-weight: bold;
        cursor: pointer;
        margin: 5px;
      }

      .modal-close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.5em;
        color: #999;
        cursor: pointer;
        line-height: 1;
      }

      .modal-close:hover {
        color: #333;
      }

      .modal {
        position: relative;
      }

      .confetti {
        position: fixed;
        width: 10px; height: 10px;
        top: -10px;
        z-index: 1001;
        animation: confettiFall 3s linear forwards;
      }

      @keyframes scaleIn {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
      }

      @keyframes confettiFall {
        0% { transform: translateY(0) rotate(0deg); opacity: 1; }
        100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
      }

      .timer-bar {
        width: 100%;
        height: 8px;
        background: #ddd;
        border-radius: 4px;
        margin-bottom: 10px;
        overflow: hidden;
      }

      .timer-fill {
        height: 100%;
        background: linear-gradient(90deg, #4ecdc4, #ff6b6b);
        transition: width 0.1s linear;
      }

      @media (max-width: 480px) {
        body { padding-top: 50px; }
        .game-area { height: 380px; }
        .balloon { width: 50px; height: 65px; }
        .balloon-body { width: 50px; height: 60px; font-size: 1.2em; }
      }
    </style>
  </head>
  <body>
    <a href="../../" class="back-link">‚Üê Back to Games</a>

    <div class="header">
      <h1>üéà Balloon Pop!</h1>
    </div>

    <div class="stats">
      <div>Score: <span id="score">0</span></div>
      <div>Level: <span id="level">1</span></div>
      <div>Best: <span id="best">0</span></div>
    </div>

    <div class="mode-selector">
      <button class="mode-btn active" onclick="setMode('numbers')">üî¢ Numbers</button>
      <button class="mode-btn" onclick="setMode('letters')">üî§ Letters</button>
      <button class="mode-btn" onclick="setMode('free')">üéØ Free Pop</button>
    </div>

    <div class="target-display" id="targetDisplay">Pop: <span id="target">1</span></div>

    <div class="timer-bar"><div class="timer-fill" id="timerFill" style="width: 100%"></div></div>

    <div class="game-area" id="gameArea"></div>

    <div class="controls">
      <button class="btn" onclick="startGame()">New Game</button>
    </div>

    <div class="modal-overlay" id="modal" onclick="closeModalOnOverlay(event)">
      <div class="modal">
        <span class="modal-close" onclick="closeModalOnly()">‚úï</span>
        <h2 id="modalTitle">üéâ Great Job!</h2>
        <div class="stars" id="starRating">
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
        </div>
        <p>Score: <span id="finalScore">0</span></p>
        <p>Level: <span id="finalLevel">1</span></p>
        <p id="highScoreMsg" class="high-score" style="display: none;">üèÜ New High Score!</p>
        <button class="modal-btn" onclick="closeModal()">Play Again</button>
      </div>
    </div>

    <script>
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      let audioCtx = null;

      function initAudio() {
        if (!audioCtx) audioCtx = new AudioContext();
      }

      function playSound(type) {
        initAudio();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'pop') {
          osc.frequency.setValueAtTime(800, audioCtx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.1);
          osc.type = 'sine';
          gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
          gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
          osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        } else if (type === 'wrong') {
          osc.frequency.setValueAtTime(200, audioCtx.currentTime);
          osc.type = 'square';
          gain.gain.setValueAtTime(0.08, audioCtx.currentTime);
          gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
          osc.start(); osc.stop(audioCtx.currentTime + 0.15);
        } else if (type === 'levelUp') {
          [523, 659, 784, 1047].forEach((f, i) => {
            const o = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            o.frequency.setValueAtTime(f, audioCtx.currentTime + i * 0.1);
            g.gain.setValueAtTime(0.12, audioCtx.currentTime + i * 0.1);
            g.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.15);
            o.start(audioCtx.currentTime + i * 0.1);
            o.stop(audioCtx.currentTime + i * 0.1 + 0.15);
          });
        }
      }

      function createConfetti() {
        const colors = ['#ff6b6b', '#4ecdc4', '#ffd700', '#a8e6cf', '#ff9ff3'];
        for (let i = 0; i < 40; i++) {
          const c = document.createElement('div');
          c.className = 'confetti';
          c.style.left = Math.random() * 100 + 'vw';
          c.style.background = colors[Math.floor(Math.random() * colors.length)];
          c.style.animationDelay = Math.random() * 1.5 + 's';
          document.body.appendChild(c);
          setTimeout(() => c.remove(), 4000);
        }
      }

      const balloonColors = ['#ff6b6b', '#4ecdc4', '#ffd700', '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43'];
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

      let mode = 'numbers';
      let score = 0, level = 1;
      let currentTarget = 1;
      let maxTarget = 10;
      let timeLeft = 30;
      let gameRunning = false;
      let timerInterval, spawnInterval;
      let best = parseInt(localStorage.getItem('balloonpop_best')) || 0;

      const gameArea = document.getElementById('gameArea');

      function setMode(m) {
        mode = m;
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        if (mode === 'free') {
          document.getElementById('targetDisplay').style.display = 'none';
        } else {
          document.getElementById('targetDisplay').style.display = 'block';
        }
        startGame();
      }

      function updateDisplay() {
        document.getElementById('score').textContent = score;
        document.getElementById('level').textContent = level;
        document.getElementById('best').textContent = best;
        
        if (mode === 'numbers') {
          document.getElementById('target').textContent = currentTarget;
        } else if (mode === 'letters') {
          document.getElementById('target').textContent = letters[currentTarget - 1] || 'A';
        }
      }

      function createBalloon(value, displayValue) {
        const balloon = document.createElement('div');
        balloon.className = 'balloon';
        balloon.dataset.value = value;

        const color = balloonColors[Math.floor(Math.random() * balloonColors.length)];
        
        balloon.innerHTML = `
          <div class="balloon-body" style="background: ${color}; border-bottom-color: ${color}">
            ${displayValue}
          </div>
          <div class="balloon-string"></div>
        `;

        const areaWidth = gameArea.offsetWidth - 70;
        const areaHeight = gameArea.offsetHeight - 90;
        balloon.style.left = Math.random() * areaWidth + 'px';
        balloon.style.top = Math.random() * areaHeight + 'px';
        balloon.style.animationDelay = Math.random() * 2 + 's';

        balloon.addEventListener('click', () => popBalloon(balloon, value));
        
        gameArea.appendChild(balloon);
      }

      function popBalloon(balloon, value) {
        if (!gameRunning) return;

        const rect = balloon.getBoundingClientRect();
        const areaRect = gameArea.getBoundingClientRect();
        const x = rect.left - areaRect.left + 30;
        const y = rect.top - areaRect.top + 35;

        if (mode === 'free' || value === currentTarget) {
          // Correct pop
          playSound('pop');
          showPopEffect(x, y);
          showScorePopup(x, y, '+10');
          
          score += 10;
          balloon.remove();

          if (mode !== 'free') {
            currentTarget++;
            if (currentTarget > maxTarget) {
              levelUp();
            }
          }
          
          updateDisplay();
        } else {
          // Wrong balloon
          playSound('wrong');
          showScorePopup(x, y, '-5');
          score = Math.max(0, score - 5);
          updateDisplay();
          
          balloon.style.animation = 'none';
          balloon.style.transform = 'scale(0.9)';
          setTimeout(() => {
            balloon.style.animation = '';
            balloon.style.transform = '';
          }, 200);
        }
      }

      function showPopEffect(x, y) {
        const effect = document.createElement('div');
        effect.className = 'pop-effect';
        effect.textContent = 'üí•';
        effect.style.left = x + 'px';
        effect.style.top = y + 'px';
        gameArea.appendChild(effect);
        setTimeout(() => effect.remove(), 400);
      }

      function showScorePopup(x, y, text) {
        const popup = document.createElement('div');
        popup.className = 'score-popup';
        popup.textContent = text;
        popup.style.left = x + 'px';
        popup.style.top = y + 'px';
        popup.style.color = text.includes('+') ? '#4ecdc4' : '#ff6b6b';
        gameArea.appendChild(popup);
        setTimeout(() => popup.remove(), 800);
      }

      function levelUp() {
        level++;
        currentTarget = 1;
        maxTarget = Math.min(10 + level * 2, 26);
        timeLeft += 15;
        playSound('levelUp');
        createConfetti();
        spawnBalloons();
        updateDisplay();
      }

      function spawnBalloons() {
        // Clear existing balloons
        document.querySelectorAll('.balloon').forEach(b => b.remove());

        const count = Math.min(6 + level, 12);
        const values = [];

        if (mode === 'numbers') {
          for (let i = currentTarget; i <= Math.min(currentTarget + count - 1, maxTarget); i++) {
            values.push({ value: i, display: i.toString() });
          }
          // Add some random numbers
          while (values.length < count) {
            const rand = Math.floor(Math.random() * maxTarget) + 1;
            values.push({ value: rand, display: rand.toString() });
          }
        } else if (mode === 'letters') {
          for (let i = currentTarget; i <= Math.min(currentTarget + count - 1, 26); i++) {
            values.push({ value: i, display: letters[i - 1] });
          }
          while (values.length < count) {
            const rand = Math.floor(Math.random() * 26) + 1;
            values.push({ value: rand, display: letters[rand - 1] });
          }
        } else {
          // Free mode - random balloons
          for (let i = 0; i < count; i++) {
            const rand = Math.floor(Math.random() * 10) + 1;
            values.push({ value: rand, display: rand.toString() });
          }
        }

        // Shuffle
        values.sort(() => Math.random() - 0.5);

        values.forEach(v => createBalloon(v.value, v.display));
      }

      function updateTimer() {
        timeLeft -= 0.1;
        const percent = (timeLeft / 30) * 100;
        document.getElementById('timerFill').style.width = Math.max(0, percent) + '%';

        if (timeLeft <= 0) {
          endGame();
        }
      }

      function startGame() {
        clearInterval(timerInterval);
        clearInterval(spawnInterval);
        document.querySelectorAll('.balloon').forEach(b => b.remove());
        document.getElementById('modal').classList.remove('show');

        score = 0;
        level = 1;
        currentTarget = 1;
        maxTarget = mode === 'letters' ? 26 : 10;
        timeLeft = 30;
        gameRunning = true;

        updateDisplay();
        spawnBalloons();

        timerInterval = setInterval(updateTimer, 100);
        spawnInterval = setInterval(() => {
          if (gameRunning && document.querySelectorAll('.balloon').length < 8) {
            const count = document.querySelectorAll('.balloon').length;
            if (count < 6) spawnBalloons();
          }
        }, 3000);
      }

      function endGame() {
        gameRunning = false;
        clearInterval(timerInterval);
        clearInterval(spawnInterval);

        const isNewBest = score > best;
        if (isNewBest) {
          best = score;
          localStorage.setItem('balloonpop_best', best);
        }

        document.getElementById('finalScore').textContent = score;
        document.getElementById('finalLevel').textContent = level;
        document.getElementById('highScoreMsg').style.display = isNewBest ? 'block' : 'none';

        const stars = document.querySelectorAll('#starRating .star');
        const starCount = score >= 300 ? 3 : score >= 150 ? 2 : 1;
        stars.forEach((s, i) => s.classList.toggle('filled', i < starCount));

        document.getElementById('modal').classList.add('show');
        if (score >= 150) createConfetti();
      }

      function closeModalOnly() {
        document.getElementById('modal').classList.remove('show');
      }

      function closeModalOnOverlay(event) {
        if (event.target === event.currentTarget) {
          closeModalOnly();
        }
      }

      function closeModal() {
        closeModalOnly();
        startGame();
      }

      updateDisplay();
      startGame();
    </script>
  </body>
</html>
